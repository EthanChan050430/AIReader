import requests
import json

def test_luxun_analysis():
    """测试鲁迅风格的分析"""
    print("=== 测试鲁迅分析风格 ===")
    
    url = 'http://localhost:80/api/expert-analysis/start'
    
    # 您提供的新闻内容
    news_content = """福建莆田的陈先生去年1月与女子陈某认识，一个月后结婚领证，女方一开始要188万元彩礼，后来实际支付了110万加一斤黄金。婚后女方拒绝与陈先生同房，当年10月前后协议离婚未成，陈先生诉至法院，一审被驳回。女方认为仍有感情基础，拒绝离婚，陈先生于是展开舆论攻势，说女方要天价彩礼目的是骗婚。

澎湃新闻6月26日报道了这一事情，拿到了莆田市秀屿区法院去年12月下发的一审判决书，引用了陈先生与陈某两方的说法。女方说拒绝同房是因为男方不尊重她，依据是婚后清明节上坟没沟通好行程。她还列举了诸如在男方家金店上班等事实，认为感情基础还在，还可以"救一下"。

对于控诉女方骗婚的陈先生，他确实得到了很多网友的支持，甚至还包括不少女性网友。百万彩礼加上女方不同房、不退钱、不离婚的"三不"态度，陈先生质疑其骗婚，似乎很有说服力。相较于男方说法，女方的"还有感情基础"等说辞，缺乏逻辑支持。目前看来，女方的结婚动机受到了普遍质疑。

尽管是闪婚，可一开始就结婚不同房，女方的这一态度或许有其他隐情，但即使放在这一地鸡毛的闪婚中看，也让人费解。网友对骗婚动机的推测，来自于陈先生认识女方是通过陈某母亲，后者知道陈先生家族做黄金生意，不缺现金。而且，女方父母是有能力但不履行司法判决的"老赖"，欠了近60万元外债。

女方父母是法院裁决的失信执行人，面临债主追债的压力，而在实际上，让女儿陈某与现金流充裕的陈先生家联姻，确实让陈某父母拿到了钱，而且100多万彩礼是打到陈某哥哥账上的——她父母账户被冻结，无法接收彩礼可以理解，但为什么不打到陈某账户，而是陈某无法控制的哥哥户头上。

也许有人说，女儿的彩礼只要不回归小家庭，用哥哥账户接收也没问题。可问题是，结婚不到一年陈先生就察觉不对，协商彩礼退还时女方只愿意退还20几万，这与陈先生的期望差距太大。如果不是骗婚，闪婚动机纯正，只退这点钱是说不出口的。陈某现在却成了自家难言之隐的挡箭牌，硬撑着不离婚。

对法院来说，只要女方不同意离婚，男方第一次提起离婚诉讼通常都会被驳回，这是不成文的惯例操作。即使不判两人离婚，也不代表法院就赞成任何一方的说法，法官只是例行签发驳回离婚诉求罢了。陈先生之所以现在加大了舆论讨伐的力度，是因为过了半年，他又可以继续提出离婚诉求了。

百万彩礼闪婚妻子拒同房，难洗骗婚嫌疑百万彩礼闪婚妻子拒同房，难洗骗婚嫌疑资料图片图文无关为了在这次离婚诉讼中占据主动位置，陈先生提出了被骗婚的指控，现在很多网友共情他，从而将压力给到法院。而网友之所以同情陈先生，是因为男性苦彩礼久矣，这桩百万彩礼离婚案更惹人关注。另外，捞女叙事早就在类似争论中占据上风，也占据道德高地，舆论形势对女方显然不利。

一场闪婚，解决了女方陈某家的现金流陷阱，几个月时间，100多万彩礼已经不知所踪。按理来说，陈某可以要求法院调查这笔巨额彩礼的流向，从陈某哥哥账户又去了哪里，用以证明骗婚的动机。但不知为何，陈先生即使控诉陈某全家人都在骗婚，却没有在公开谴责中公布这方面证据，这让人略微不解。

陈先生在一审败诉的半年后，还可以继续提起离婚诉讼。但明眼人都知道，两下真正要争的并不是能不能离婚，陈先生也拿不回100多万彩礼的全部，但可以争取对自己有利的彩礼返还方案。假如法官也受舆论的影响，自由心证女方的闪婚动机存疑，他就会赢得更多，拿回更多。

这样看来，陈先生用舆论碾压女方，完全是策略考虑，实际上该策略很有效。官方民间对天价彩礼的声讨追打，网民对捞女的憎恶，直接把赚取100万彩礼不还的女方家推向舆论场的被告席。不离婚、不退钱、不同房的女方取态，更是火上浇油。毕竟哪怕外人都觉得难以理解，既不履行夫妻义务又不同意离婚，这是要干什么呢？如果法院还不判离婚，男方能怎么办？

当然，目前舆论场传播的主要还是男方说法，事情或许会有反转可能。在性别冲突普遍存在、彩礼问题争议很大的舆论生态中，这起案例恐怕还要在热搜上待一段时间，且看各方最后如何收场。"""
    
    data = {
        'content_type': 'text',
        'content_data': news_content,
        'persona': 'luxun'
    }
    
    try:
        response = requests.post(url, data=data, stream=True)
        print(f'状态码: {response.status_code}')
        
        content_buffer = ""
        
        for line in response.iter_lines(decode_unicode=True):
            if line and line.startswith('data: '):
                try:
                    json_str = line[6:].strip()
                    if json_str and json_str != '[DONE]':
                        data_obj = json.loads(json_str)
                        
                        if data_obj.get('type') == 'content':
                            content = data_obj.get('content', '')
                            content_buffer += content
                            print(content, end='', flush=True)
                        elif data_obj.get('type') == 'done':
                            print('\n\n=== 分析完成 ===')
                            print(f'总字数: {len(content_buffer)} 字符')
                            break
                            
                except json.JSONDecodeError as e:
                    pass
                    
    except Exception as e:
        print(f'请求错误: {e}')

if __name__ == '__main__':
    test_luxun_analysis()
